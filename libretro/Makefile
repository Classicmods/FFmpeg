OPENGL = 1
BAKE_IN_FFMPEG = 0
HAVE_SSE2 = 0
HAVE_MMX = 0

ifeq ($(platform),)
platform = unix
ifeq ($(shell uname -a),)
   platform = win
else ifneq ($(findstring MINGW,$(shell uname -a)),)
   platform = win
else ifneq ($(findstring Darwin,$(shell uname -a)),)
   platform = osx
else ifneq ($(findstring win,$(shell uname -a)),)
   platform = win
endif
endif

system = $(shell uname -m)

ifeq ($(system),x86_64)
ARCH_X86 = 1
ARCH_X86_64 = 1
endif

TARGET_NAME := ffmpeg

ifneq (,$(findstring unix,$(platform)))
	ARCH_X86 = 1
   TARGET := $(TARGET_NAME)_libretro.so
   fpic := -fPIC
   SHARED := -shared -Wl,--version-script=link.T -Wl,--no-undefined -fPIC
ifeq ($(OPENGL),1)
   GL_LIB := -lGL
   CFLAGS += -DHAVE_GL
   HAVE_GL := 1
endif
   HAVE_SSA := 1

   LIBS = $(shell pkg-config libavcodec libass --libs) -pthread
   CFLAGS += $(shell pkg-config libavcodec libass --cflags) -pthread
	CFLAGS += -DHAVE_STRUCT_SOCKADDR_STORAGE -DHAVE_STRUCT_ADDRINFO
	HAVE_POLL_H = 1
	HAVE_GETADDRINFO = 1
	HAVE_NETWORK = 1
	HAVE_SOCKLEN = 1
ifeq ($(BAKE_IN_FFMPEG),0)
   LIBS += $(shell pkg-config libavutil libavformat libswresample libswscale --libs)
   CFLAGS += $(shell pkg-config libavutil libavformat libswresample libswscale --cflags)
endif
else ifneq (,$(findstring osx,$(platform)))
	ARCH_X86 = 1
   TARGET := $(TARGET_NAME)_libretro.dylib
   fpic := -fPIC
   SHARED := -dynamiclib
ifeq ($(OPENGL),1)
   GL_LIB := -framework OpenGL
   HAVE_GL := 1
   CFLAGS += -DHAVE_GL
endif
   HAVE_SSA := 1
OSXVER = `sw_vers -productVersion | cut -c 4`
ifneq ($(OSXVER),9)
   fpic += -mmacosx-version-min=10.5
endif

   LIBS = $(shell pkg-config libavcodec libass --libs) -pthread
   CFLAGS += $(shell pkg-config libavcodec libass --cflags) -pthread
ifeq ($(BAKE_IN_FFMPEG),0)
   LIBS += $(shell pkg-config libavutil libavformat libswresample libswscale --libs)
   CFLAGS += $(shell pkg-config libavutil libavformat libswresample libswscale --cflags)
endif
else ifneq (,$(findstring win,$(platform)))
	ARCH_X86 = 1
   CC = gcc
   TARGET := $(TARGET_NAME)_libretro.dll
   SHARED := -shared -static-libgcc -static-libstdc++ -s -Wl,--version-script=link.T -Wl,--no-undefined
   CFLAGS += -Iffmpeg
ifeq ($(OPENGL),1)
   GL_LIB := -lopengl32
   CFLAGS += -DHAVE_GL
   HAVE_GL := 1
endif
   LIBS += -L. -lavcodec
ifeq ($(BAKE_IN_FFMPEG),0)
	LIBS += -lavformat -lavutil -lswresample -lwscale
endif
endif

ifeq ($(HAVE_SSA), 1)
   LIBS += $(shell pkg-config libass --libs)
   CFLAGS += -DHAVE_SSA
endif

SOURCE := libretro.c fifo_buffer.c thread.c

ifeq ($(BAKE_IN_FFMPEG),1)
LIBS += -lm

ifeq ($(HAVE_BIGENDIAN),1)
CPUOPTS += -DHAVE_BIGENDIAN=1
else
CPUOPTS += -DHAVE_BIGENDIAN=0
endif


#Blackfin DSP. Pretty sure we won't target this for libretro (if ever).

CPUOPTS += -DARCH_BFIN=0

#We can reasonably assume MMX will be there on all x86 CPUs from 1997 and up at least
#SSE2 can be assumed from Pentium 4 and up - can be switched on or off with the switch HAVE_SSE2

CPUOPTS += -DHAVE_AMD3DNOW_INLINE=0

ifeq ($(ARCH_X86),1)
CPUOPTS += -DARCH_X86=1
CPUOPTS += -DHAVE_MMX2=0
ifeq ($(HAVE_MMX), 1)
CPUOPTS += -DHAVE_MMX=1
CPUOPTS += -DHAVE_MMXEXT=1
CPUOPTS += -DHAVE_MMX_INLINE=1 -DHAVE_MMXEXT_INLINE=0
else
CPUOPTS += -DHAVE_MMX=0
CPUOPTS += -DHAVE_MMXEXT=0
CPUOPTS += -DHAVE_MMX_INLINE=0 -DHAVE_MMXEXT_INLINE=0
endif
CPUOPTS += -DHAVE_ALIGNED_STACK -DHAVE_FAST_UNALIGNED=0

ifeq ($(HAVE_SSE2),1)
CPUOPTS += -DHAVE_SSE2=1
endif
CPUOPTS += -DHAVE_SSE2_EXTERNAL=0
CPUOPTS += -DHAVE_SSE3_EXTERNAL=0
CPUOPTS += -DHAVE_SSSE3_EXTERNAL=0
CPUOPTS += -DHAVE_SSE4_EXTERNAL=0
CPUOPTS += -DHAVE_AVX_EXTERNAL=0
else
CPUOPTS += -DHAVE_SSE2_EXTERNAL=0
CPUOPTS += -DHAVE_SSE3_EXTERNAL=0
CPUOPTS += -DHAVE_SSSE3_EXTERNAL=0
CPUOPTS += -DHAVE_SSE4_EXTERNAL=0
CPUOPTS += -DHAVE_AVX_EXTERNAL=0
endif

ifeq ($(ARCH_X86_64),1)
CPUOPTS += -DARCH_X86_64=1
else
CPUOPTS += -DARCH_X86_64=0
endif

#This is ARMv8/NEON
ifeq ($(ARCH_AARCH64),1)
CPUOPTS += -DARCH_AARCH64=1
else
CPUOPTS += -DARCH_AARCH64=0
endif

ifeq ($(ARCH_ARM),1)
CPUOPTS += -DARCH_ARM=1
else
CPUOPTS += -DARCH_ARM=0
endif
ifeq ($(ARCH_PPC),1)
CPUOPTS += -DARCH_PPC=1
else
CPUOPTS += -DARCH_PPC=0
endif

ifeq ($(HAVE_ALTIVEC),1)
CPUOPTS += -DHAVE_ALTIVEC=1
else
CPUOPTS += -DHAVE_ALTIVEC=0
endif
CFLAGS += -I$(BASE_DIR) -I. -DHAVE_CBRT -DHAVE_CBRTF -DHAVE_ISINF -DHAVE_ISNAN -DHAVE_RINT -DHAVE_LRINT -DHAVE_LRINTF -DHAVE_ROUND -DHAVE_ROUNDF -DHAVE_TRUNC -DHAVE_TRUNCF -DHAVE_YASM=0 $(CPUOPTS)

ifeq ($(HAVE_POLL_H),1)
CFLAGS += -DHAVE_POLL_H
endif

ifeq ($(HAVE_SOCKLEN),1)
CFLAGS += -DHAVE_SOCKLEN_T
endif

ifeq ($(HAVE_GETADDRINFO),1)
CFLAGS += -DHAVE_GETADDRINFO=1
endif

ifeq ($(HAVE_NETWORK),1)
CFLAGS += -DCONFIG_NETWORK=1
endif

#General flags
CFLAGS +=  \
			  -DCONFIG_BLURAY_PROTOCOL=0 \
			  -DCONFIG_CACHE_PROTOCOL=1 \
			  -DCONFIG_CONCAT_PROTOCOL=1 \
			  -DCONFIG_CRYPTO_PROTOCOL=1 \
			  -DCONFIG_DATA_PROTOCOL=1 \
			  -DCONFIG_FFRTMPCRYPT_PROTOCOL=0 \
			  -DCONFIG_FFRTMPHTTP_PROTOCOL=1 \
			  -DCONFIG_FILE_PROTOCOL=1 \
			  -DCONFIG_FTP_PROTOCOL=1 \
			  -DCONFIG_GOPHER_PROTOCOL=1 \
			  -DCONFIG_HLS_PROTOCOL=1 \
			  -DCONFIG_SUBFILE_PROTOCOL=0 \
			  -DCONFIG_HTTP_PROTOCOL=1 \
			  -DCONFIG_HTTPPROXY_PROTOCOL=1 \
			  -DCONFIG_HTTPS_PROTOCOL=0 \
			  -DCONFIG_MMSH_PROTOCOL=1 \
			  -DCONFIG_MMST_PROTOCOL=1 \
			  -DCONFIG_MD5_PROTOCOL=1 \
			  -DCONFIG_PIPE_PROTOCOL=1 \
			  -DCONFIG_RTMP_PROTOCOL=1 \
			  -DCONFIG_RTMPE_PROTOCOL=0 \
			  -DCONFIG_RTMPS_PROTOCOL=0 \
			  -DCONFIG_RTMPT_PROTOCOL=1 \
			  -DCONFIG_RTMPTE_PROTOCOL=0 \
			  -DCONFIG_RTMPTS_PROTOCOL=0 \
			  -DCONFIG_RTP_PROTOCOL=1 \
			  -DCONFIG_SCTP_PROTOCOL=0 \
			  -DCONFIG_SRTP_PROTOCOL=1 \
			  -DCONFIG_TCP_PROTOCOL=1 \
			  -DCONFIG_TLS_PROTOCOL=0 \
			  -DCONFIG_UDP_PROTOCOL=1 \
			  -DCONFIG_UNIX_PROTOCOL=1 \
			  -DCONFIG_LIBRTMP_PROTOCOL=0 \
			  -DCONFIG_LIBRTMPE_PROTOCOL=0 \
			  -DCONFIG_LIBRTMPS_PROTOCOL=0 \
			  -DCONFIG_LIBRTMPT_PROTOCOL=0 \
			  -DCONFIG_LIBRTMPTE_PROTOCOL=0 \
			  -DCONFIG_LIBSSH_PROTOCOL=0

#libswresample
AVFORMAT_DIR   := ../libavformat
AVCODEC_DIR    := ../libavcodec
AVUTIL_DIR     := ../libavutil
SWSCALE_DIR    := ../libswscale
SWRESAMPLE_DIR := ../libswresample
BASE_DIR := ../

#avutil
CFLAGS += -DHAVE_AV_CONFIG_H

SOURCE += $(AVUTIL_DIR)/atomic.c \
			 $(AVUTIL_DIR)/adler32.c \
			 $(AVUTIL_DIR)/aes.c \
			 $(AVUTIL_DIR)/avstring.c \
			 $(AVUTIL_DIR)/base64.c \
			 $(AVUTIL_DIR)/buffer.c \
			 $(AVUTIL_DIR)/crc.c \
			 $(AVUTIL_DIR)/des.c \
			 $(AVUTIL_DIR)/dict.c \
			 $(AVUTIL_DIR)/eval.c \
			 $(AVUTIL_DIR)/error.c \
			 $(AVUTIL_DIR)/file.c \
			 $(AVUTIL_DIR)/fifo.c \
			 $(AVUTIL_DIR)/frame.c \
			 $(AVUTIL_DIR)/hash.c \
			 $(AVUTIL_DIR)/hmac.c \
			 $(AVUTIL_DIR)/lfg.c \
			 $(AVUTIL_DIR)/mathematics.c \
			 $(AVUTIL_DIR)/mem.c \
			 $(AVUTIL_DIR)/murmur3.c \
			 $(AVUTIL_DIR)/channel_layout.c \
			 $(AVUTIL_DIR)/opt.c \
			 $(AVUTIL_DIR)/sha.c \
			 $(AVUTIL_DIR)/sha512.c \
			 $(AVUTIL_DIR)/bprint.c \
			 $(AVUTIL_DIR)/parseutils.c \
			 $(AVUTIL_DIR)/random_seed.c \
			 $(AVUTIL_DIR)/rc4.c \
			 $(AVUTIL_DIR)/pixdesc.c \
			 $(AVUTIL_DIR)/rational.c \
			 $(AVUTIL_DIR)/ripemd.c \
			 $(AVUTIL_DIR)/imgutils.c \
			 $(AVUTIL_DIR)/samplefmt.c \
			 $(AVUTIL_DIR)/log.c \
			 $(AVUTIL_DIR)/cpu.c \
			 $(AVUTIL_DIR)/time.c \
			 $(AVUTIL_DIR)/timecode.c \
			 $(AVUTIL_DIR)/tree.c \
			 $(AVUTIL_DIR)/utils.c \
			 $(AVUTIL_DIR)/md5.c \
			 $(AVUTIL_DIR)/log2_tab.c

ifeq ($(ARCH_X86),1)
			 SOURCE += $(AVUTIL_DIR)/x86/cpu.c
endif

ifeq ($(ARCH_PPC),1)
			SOURCE += $(AVUTIL_DIR)/ppc/cpu.c \
						 $(AVUTIL_DIR)/ppc/float_dsp_init.c
endif

ifeq ($(HAVE_ALTIVEC),1)
			SOURCE += $(AVUTIL_DIR)/ppc/float_dsp_altivec.c
endif

ifeq ($(ARCH_ARM),1)
			 SOURCE += $(AVUTIL_DIR)/arm/cpu.c
endif

#libswscale
CFLAGS += -DHAVE_SWSCALE_H -DCONFIG_SWSCALE_ALPHA=1
SOURCE += $(SWSCALE_DIR)/input.c \
			 $(SWSCALE_DIR)/options.c \
			 $(SWSCALE_DIR)/output.c \
			 $(SWSCALE_DIR)/rgb2rgb.c \
			 $(SWSCALE_DIR)/swscale.c \
			 $(SWSCALE_DIR)/swscale_unscaled.c \
			 $(SWSCALE_DIR)/utils.c \
			 $(SWSCALE_DIR)/yuv2rgb.c

ifeq ($(ARCH_X86),1)
			 SOURCE += $(SWSCALE_DIR)/x86/rgb2rgb.c \
				 			$(SWSCALE_DIR)/x86/swscale.c \
							$(SWSCALE_DIR)/x86/yuv2rgb.c
endif

ifeq ($(ARCH_ARM),1)
			 SOURCE += $(SWSCALE_DIR)/arm/swscale_unscaled.c
endif

#libswresample

SOURCE += $(SWRESAMPLE_DIR)/audioconvert.c \
			 $(SWRESAMPLE_DIR)/dither.c \
			 $(SWRESAMPLE_DIR)/rematrix.c \
			 $(SWRESAMPLE_DIR)/resample.c \
			 $(SWRESAMPLE_DIR)/swresample.c

#libavformat
CFLAGS += -DCONFIG_MUXERS=1

AVFORMAT_BLACKLIST := \
	$(AVFORMAT_DIR)/bluray.c \
	$(AVFORMAT_DIR)/libnut.c \
	$(AVFORMAT_DIR)/tls.c \
	$(AVFORMAT_DIR)/libgme.c \
	$(AVFORMAT_DIR)/libquvi.c \
	$(AVFORMAT_DIR)/libmodplug.c \
	$(AVFORMAT_DIR)/librtmp.c \
	$(AVFORMAT_DIR)/libssh.c \
	$(AVFORMAT_DIR)/avisynth.c \
	$(AVFORMAT_DIR)/log2_tab.c \
	$(AVFORMAT_DIR)/rtmpd.c \
	$(AVFORMAT_DIR)/noproxy-test.c \
	$(AVFORMAT_DIR)/seek-test.c \
	$(AVFORMAT_DIR)/rtmpdh.c \
	$(AVFORMAT_DIR)/rtmpcrypt.c \
	$(AVFORMAT_DIR)/sctp.c

ifneq ($(HAVE_POLL_H),1)
AVFORMAT_BLACKLIST += $(AVFORMAT_DIR)/sapdec.c
endif

SOURCE += $(filter-out $(AVFORMAT_BLACKLIST),$(wildcard $(AVFORMAT_DIR)/*.c))
SOURCE += $(AVCODEC_DIR)/raw.c $(AVCODEC_DIR)/exif.c $(AVCODEC_DIR)/tiff_common.c

CFLAGS += -DHAVE_AVFORMAT_H

CFLAGS += -DCONFIG_LIBMP3LAME=1 \
			 -DCONFIG_LIBVORBIS=1 \
			 -DCONFIG_ZLIB=0 

# Encoding switches

CFLAGS += \
			 -DCONFIG_LIBVORBIS_ENCODER=0 \
			 -DCONFIG_LIBX264_ENCODER=0 \

CFLAGS += -DCONFIG_RTPDEC=1

# Muxers
CFLAGS += -DCONFIG_A64_MUXER=1 \
			 -DCONFIG_AC3_MUXER=1 \
			 -DCONFIG_ADTS_MUXER=1 \
			 -DCONFIG_ADX_MUXER=1 \
			 -DCONFIG_AIFF_MUXER=1 \
			 -DCONFIG_AMR_MUXER=1 \
			 -DCONFIG_ASF_MUXER=1 \
			 -DCONFIG_ASS_MUXER=1 \
			 -DCONFIG_AST_MUXER=1 \
			 -DCONFIG_ASF_STREAM_MUXER=1 \
			 -DCONFIG_AU_MUXER=1 \
			 -DCONFIG_AVI_MUXER=1 \
			 -DCONFIG_AVM2_MUXER=1 \
			 -DCONFIG_BIT_MUXER=1 \
			 -DCONFIG_CAF_MUXER=1 \
			 -DCONFIG_CAVSVIDEO_MUXER=1 \
			 -DCONFIG_CRC_MUXER=1 \
			 -DCONFIG_DATA_MUXER=1 \
			 -DCONFIG_DAUD_MUXER=1 \
			 -DCONFIG_DIRAC_MUXER=1 \
			 -DCONFIG_DNXHD_MUXER=1 \
			 -DCONFIG_DTS_MUXER=1 \
			 -DCONFIG_DV_MUXER=1 \
			 -DCONFIG_EAC3_MUXER=1 \
			 -DCONFIG_F4V_MUXER=1 \
			 -DCONFIG_FFM_MUXER=1 \
			 -DCONFIG_FFMETADATA_MUXER=1 \
			 -DCONFIG_FILMSTRIP_MUXER=1 \
			 -DCONFIG_FLAC_MUXER=1 \
			 -DCONFIG_FLV_MUXER=1 \
			 -DCONFIG_FRAMECRC_MUXER=1 \
			 -DCONFIG_FRAMEMD5_MUXER=1 \
			 -DCONFIG_G722_MUXER=1 \
			 -DCONFIG_G723_1_MUXER=1 \
			 -DCONFIG_GIF_MUXER=1 \
			 -DCONFIG_GXF_MUXER=1 \
			 -DCONFIG_H261_MUXER=1 \
			 -DCONFIG_H263_MUXER=1 \
			 -DCONFIG_H264_MUXER=1 \
			 -DCONFIG_HLS_MUXER=1 \
			 -DCONFIG_ICO_MUXER=1 \
			 -DCONFIG_ILBC_MUXER=1 \
			 -DCONFIG_IMAGE2_MUXER=1 \
			 -DCONFIG_IMAGE2PIPE_MUXER=1 \
			 -DCONFIG_IPOD_MUXER=1 \
			 -DCONFIG_IRCAM_MUXER=1 \
			 -DCONFIG_ISMV_MUXER=1 \
			 -DCONFIG_IVF_MUXER=1 \
			 -DCONFIG_JACOSUB_MUXER=1 \
			 -DCONFIG_LATM_MUXER=1 \
			 -DCONFIG_M4V_MUXER=1 \
			 -DCONFIG_MD5_MUXER=1 \
			 -DCONFIG_MATROSKA_MUXER=1 \
			 -DCONFIG_MATROSKA_AUDIO_MUXER=1 \
			 -DCONFIG_MICRODVD_MUXER=1 \
			 -DCONFIG_MJPEG_MUXER=1 \
			 -DCONFIG_HDS_MUXER=1 \
			 -DCONFIG_HEVC_MUXER=1 \
			 -DCONFIG_MLP_MUXER=1 \
			 -DCONFIG_MMF_MUXER=1 \
			 -DCONFIG_MOV_MUXER=1 \
			 -DCONFIG_MP2_MUXER=1 \
			 -DCONFIG_MP3_MUXER=1 \
			 -DCONFIG_MP4_MUXER=1 \
			 -DCONFIG_MPEG1SYSTEM_MUXER=1 \
			 -DCONFIG_MPEG1VCD_MUXER=1 \
			 -DCONFIG_MPEG1VIDEO_MUXER=1 \
			 -DCONFIG_MPEG2DVD_MUXER=1 \
			 -DCONFIG_MPEG2SVCD_MUXER=1 \
			 -DCONFIG_MPEG2VIDEO_MUXER=1 \
			 -DCONFIG_MPEG2VOB_MUXER=1 \
			 -DCONFIG_MPEGTS_MUXER=1 \
			 -DCONFIG_MPJPEG_MUXER=1 \
			 -DCONFIG_MXF_MUXER=1 \
			 -DCONFIG_MXF_D10_MUXER=1 \
			 -DCONFIG_LIBNUT_MUXER=0 \
			 -DCONFIG_NULL_MUXER=1 \
			 -DCONFIG_NUT_MUXER=1 \
			 -DCONFIG_OGG_MUXER=1 \
			 -DCONFIG_OMA_MUXER=1 \
			 -DCONFIG_PCM_ALAW_MUXER=1 \
			 -DCONFIG_PCM_MULAW_MUXER=1 \
			 -DCONFIG_PCM_F64BE_MUXER=1 \
			 -DCONFIG_PCM_F64LE_MUXER=1 \
			 -DCONFIG_PCM_F32BE_MUXER=1 \
			 -DCONFIG_PCM_F32LE_MUXER=1 \
			 -DCONFIG_PCM_S32BE_MUXER=1 \
			 -DCONFIG_PCM_S32LE_MUXER=1 \
			 -DCONFIG_PCM_S24BE_MUXER=1 \
			 -DCONFIG_PCM_S24LE_MUXER=1 \
			 -DCONFIG_PCM_S16BE_MUXER=1 \
			 -DCONFIG_PCM_S16LE_MUXER=1 \
			 -DCONFIG_PCM_S8_MUXER=1 \
			 -DCONFIG_PCM_U32BE_MUXER=1 \
			 -DCONFIG_PCM_U32LE_MUXER=1 \
			 -DCONFIG_PCM_U24BE_MUXER=1 \
			 -DCONFIG_PCM_U24LE_MUXER=1 \
			 -DCONFIG_PCM_U16BE_MUXER=1 \
			 -DCONFIG_PCM_U16LE_MUXER=1 \
			 -DCONFIG_PCM_U8_MUXER=1 \
			 -DCONFIG_PSP_MUXER=1 \
			 -DCONFIG_RAWVIDEO_MUXER=1 \
			 -DCONFIG_RM_MUXER=1 \
			 -DCONFIG_ROQ_MUXER=1 \
			 -DCONFIG_RSO_MUXER=1 \
			 -DCONFIG_RTP_MUXER=1 \
			 -DCONFIG_OGA_MUXER=1 \
			 -DCONFIG_OPUS_MUXER=1 \
			 -DCONFIG_RTSP_MUXER=1 \
			 -DCONFIG_SAP_MUXER=1 \
			 -DCONFIG_SEGMENT_MUXER=1 \
			 -DCONFIG_STREAM_SEGMENT_MUXER=1 \
			 -DCONFIG_SMJPEG_MUXER=1 \
			 -DCONFIG_SMOOTHSTREAMING_MUXER=1 \
			 -DCONFIG_SOX_MUXER=1 \
			 -DCONFIG_SPDIF_MUXER=1 \
			 -DCONFIG_SRT_MUXER=1 \
			 -DCONFIG_SWF_MUXER=1 \
			 -DCONFIG_TEE_MUXER=1 \
			 -DCONFIG_TG2_MUXER=1 \
			 -DCONFIG_TGP_MUXER=1 \
			 -DCONFIG_MKVTIMESTAMP_V2_MUXER=1 \
			 -DCONFIG_TRUEHD_MUXER=1 \
			 -DCONFIG_VC1_MUXER=1 \
			 -DCONFIG_SPEEX_MUXER=1 \
			 -DCONFIG_VC1T_MUXER=1 \
			 -DCONFIG_VOC_MUXER=1 \
			 -DCONFIG_UNCODEDFRAMECRC_MUXER=1 \
			 -DCONFIG_W64_MUXER=1 \
			 -DCONFIG_WAV_MUXER=1 \
			 -DCONFIG_WEBM_MUXER=1 \
			 -DCONFIG_WEBVTT_MUXER=1 \
			 -DCONFIG_WTV_MUXER=1 \
			 -DCONFIG_WV_MUXER=1 \
			 -DCONFIG_YUV4MPEGPIPE_MUXER=1 \
			 -DCONFIG_LIBNUT_MUXER=0

CFLAGS += -DCONFIG_AAC_DEMUXER=1 \
			 -DCONFIG_AC3_DEMUXER=1 \
			 -DCONFIG_ACT_DEMUXER=1 \
			 -DCONFIG_ADF_DEMUXER=1 \
			 -DCONFIG_SDR2_DEMUXER=1 \
			 -DCONFIG_ADP_DEMUXER=1 \
			 -DCONFIG_ADX_DEMUXER=1 \
			 -DCONFIG_AEA_DEMUXER=1 \
			 -DCONFIG_AFC_DEMUXER=1 \
			 -DCONFIG_AIFF_DEMUXER=1 \
			 -DCONFIG_AMR_DEMUXER=1 \
			 -DCONFIG_ANM_DEMUXER=1 \
			 -DCONFIG_APC_DEMUXER=1 \
			 -DCONFIG_APE_DEMUXER=1 \
			 -DCONFIG_AQTITLE_DEMUXER=1 \
			 -DCONFIG_ASF_DEMUXER=1 \
			 -DCONFIG_ASS_DEMUXER=1 \
			 -DCONFIG_AST_DEMUXER=1 \
			 -DCONFIG_AU_DEMUXER=1 \
			 -DCONFIG_AVI_DEMUXER=1 \
			 -DCONFIG_AVISYNTH_DEMUXER=0 \
			 -DCONFIG_AVR_DEMUXER=1 \
			 -DCONFIG_AVS_DEMUXER=1 \
			 -DCONFIG_BETHSOFTVID_DEMUXER=1 \
			 -DCONFIG_BFI_DEMUXER=1 \
			 -DCONFIG_BINTEXT_DEMUXER=1 \
			 -DCONFIG_BINK_DEMUXER=1 \
			 -DCONFIG_BIT_DEMUXER=1 \
			 -DCONFIG_BMV_DEMUXER=1 \
			 -DCONFIG_BRSTM_DEMUXER=1 \
			 -DCONFIG_BOA_DEMUXER=1 \
			 -DCONFIG_C93_DEMUXER=1 \
			 -DCONFIG_CAF_DEMUXER=1 \
			 -DCONFIG_CAVSVIDEO_DEMUXER=1 \
			 -DCONFIG_CINE_DEMUXER=1 \
			 -DCONFIG_CDG_DEMUXER=1 \
			 -DCONFIG_CDXL_DEMUXER=1 \
			 -DCONFIG_CONCAT_DEMUXER=1 \
			 -DCONFIG_DATA_DEMUXER=1 \
			 -DCONFIG_DAUD_DEMUXER=1 \
			 -DCONFIG_DFA_DEMUXER=1 \
			 -DCONFIG_DSF_DEMUXER=1 \
			 -DCONFIG_DIRAC_DEMUXER=1 \
			 -DCONFIG_DNXHD_DEMUXER=1 \
			 -DCONFIG_DSICIN_DEMUXER=1 \
			 -DCONFIG_DTS_DEMUXER=1 \
			 -DCONFIG_DTSHD_DEMUXER=1 \
			 -DCONFIG_DV_DEMUXER=1 \
			 -DCONFIG_DXA_DEMUXER=1 \
			 -DCONFIG_EA_DEMUXER=1 \
			 -DCONFIG_EA_CDATA_DEMUXER=1 \
			 -DCONFIG_EAC3_DEMUXER=1 \
			 -DCONFIG_EPAF_DEMUXER=1 \
			 -DCONFIG_FFM_DEMUXER=1 \
			 -DCONFIG_FFMETADATA_DEMUXER=1 \
			 -DCONFIG_FILMSTRIP_DEMUXER=1 \
			 -DCONFIG_FLAC_DEMUXER=1 \
			 -DCONFIG_IMAGE2_ALIAS_PIX_DEMUXER=1 \
			 -DCONFIG_IMAGE2_BRENDER_PIX_DEMUXER=1 \
			 -DCONFIG_FLIC_DEMUXER=1 \
			 -DCONFIG_FLV_DEMUXER=1 \
			 -DCONFIG_FOURXM_DEMUXER=1 \
			 -DCONFIG_FRM_DEMUXER=1 \
			 -DCONFIG_G722_DEMUXER=1 \
			 -DCONFIG_G723_1_DEMUXER=1 \
			 -DCONFIG_G729_DEMUXER=1 \
			 -DCONFIG_GIF_DEMUXER=1 \
			 -DCONFIG_GSM_DEMUXER=1 \
			 -DCONFIG_GXF_DEMUXER=1 \
			 -DCONFIG_H261_DEMUXER=1 \
			 -DCONFIG_H263_DEMUXER=1 \
			 -DCONFIG_H264_DEMUXER=1 \
			 -DCONFIG_HEVC_DEMUXER=1 \
			 -DCONFIG_HLS_DEMUXER=1 \
			 -DCONFIG_HNM_DEMUXER=1 \
			 -DCONFIG_ICO_DEMUXER=1 \
			 -DCONFIG_IDCIN_DEMUXER=1 \
			 -DCONFIG_IDF_DEMUXER=1 \
			 -DCONFIG_IFF_DEMUXER=1 \
			 -DCONFIG_ILBC_DEMUXER=1 \
			 -DCONFIG_IMAGE2_DEMUXER=1 \
			 -DCONFIG_IMAGE2PIPE_DEMUXER=1 \
			 -DCONFIG_INGENIENT_DEMUXER=1 \
			 -DCONFIG_IPMOVIE_DEMUXER=1 \
			 -DCONFIG_IRCAM_DEMUXER=1 \
			 -DCONFIG_ISS_DEMUXER=1 \
			 -DCONFIG_IV8_DEMUXER=1 \
			 -DCONFIG_IVF_DEMUXER=1 \
			 -DCONFIG_JACOSUB_DEMUXER=1 \
			 -DCONFIG_JV_DEMUXER=1 \
			 -DCONFIG_LATM_DEMUXER=1 \
			 -DCONFIG_LMLM4_DEMUXER=1 \
			 -DCONFIG_LOAS_DEMUXER=1 \
			 -DCONFIG_LVF_DEMUXER=1 \
			 -DCONFIG_LXF_DEMUXER=1 \
			 -DCONFIG_M4V_DEMUXER=1 \
			 -DCONFIG_MATROSKA_DEMUXER=1 \
			 -DCONFIG_MGSTS_DEMUXER=1 \
			 -DCONFIG_MICRODVD_DEMUXER=1 \
			 -DCONFIG_MJPEG_DEMUXER=1 \
			 -DCONFIG_MLP_DEMUXER=1 \
			 -DCONFIG_MM_DEMUXER=1 \
			 -DCONFIG_MMF_DEMUXER=1 \
			 -DCONFIG_MOV_DEMUXER=1 \
			 -DCONFIG_MP3_DEMUXER=1 \
			 -DCONFIG_MPC_DEMUXER=1 \
			 -DCONFIG_MPC8_DEMUXER=1 \
			 -DCONFIG_MPEGPS_DEMUXER=1 \
			 -DCONFIG_MPEGTS_DEMUXER=1 \
			 -DCONFIG_MPEGTSRAW_DEMUXER=1 \
			 -DCONFIG_MPEGVIDEO_DEMUXER=1 \
			 -DCONFIG_MPL2_DEMUXER=1 \
			 -DCONFIG_MLV_DEMUXER=1 \
			 -DCONFIG_MPSUB_DEMUXER=1 \
			 -DCONFIG_MSNWC_TCP_DEMUXER=1 \
			 -DCONFIG_MTV_DEMUXER=1 \
			 -DCONFIG_MV_DEMUXER=1 \
			 -DCONFIG_MVI_DEMUXER=1 \
			 -DCONFIG_MXF_DEMUXER=1 \
			 -DCONFIG_MXG_DEMUXER=1 \
			 -DCONFIG_NC_DEMUXER=1 \
			 -DCONFIG_NISTSPHERE_DEMUXER=1 \
			 -DCONFIG_NSV_DEMUXER=1 \
			 -DCONFIG_NUT_DEMUXER=1 \
			 -DCONFIG_NUV_DEMUXER=1 \
			 -DCONFIG_OGG_DEMUXER=1 \
			 -DCONFIG_OMA_DEMUXER=1 \
			 -DCONFIG_PAF_DEMUXER=1 \
			 -DCONFIG_PCM_ALAW_DEMUXER=1 \
			 -DCONFIG_PCM_MULAW_DEMUXER=1 \
			 -DCONFIG_PCM_F64BE_DEMUXER=1 \
			 -DCONFIG_PCM_F64LE_DEMUXER=1 \
			 -DCONFIG_PCM_F32BE_DEMUXER=1 \
			 -DCONFIG_PCM_F32LE_DEMUXER=1 \
			 -DCONFIG_PCM_S32BE_DEMUXER=1 \
			 -DCONFIG_PCM_S32LE_DEMUXER=1 \
			 -DCONFIG_PCM_S24BE_DEMUXER=1 \
			 -DCONFIG_PCM_S24LE_DEMUXER=1 \
			 -DCONFIG_PCM_S16BE_DEMUXER=1 \
			 -DCONFIG_PCM_S16LE_DEMUXER=1 \
			 -DCONFIG_PCM_S8_DEMUXER=1 \
			 -DCONFIG_PCM_U32BE_DEMUXER=1 \
			 -DCONFIG_PCM_U32LE_DEMUXER=1 \
			 -DCONFIG_PCM_U24BE_DEMUXER=1 \
			 -DCONFIG_PCM_U24LE_DEMUXER=1 \
			 -DCONFIG_PCM_U16BE_DEMUXER=1 \
			 -DCONFIG_PCM_U16LE_DEMUXER=1 \
			 -DCONFIG_PCM_U8_DEMUXER=1 \
			 -DCONFIG_PJS_DEMUXER=1 \
			 -DCONFIG_PMP_DEMUXER=1 \
			 -DCONFIG_PVA_DEMUXER=1 \
			 -DCONFIG_PVF_DEMUXER=1 \
			 -DCONFIG_QCP_DEMUXER=1 \
			 -DCONFIG_R3D_DEMUXER=1 \
			 -DCONFIG_RAWVIDEO_DEMUXER=1 \
			 -DCONFIG_REALTEXT_DEMUXER=1 \
			 -DCONFIG_REDSPARK_DEMUXER=1 \
			 -DCONFIG_RL2_DEMUXER=1 \
			 -DCONFIG_RM_DEMUXER=1 \
			 -DCONFIG_ROQ_DEMUXER=1 \
			 -DCONFIG_RPL_DEMUXER=1 \
			 -DCONFIG_RSD_DEMUXER=1 \
			 -DCONFIG_RSO_DEMUXER=1 \
			 -DCONFIG_RTP_DEMUXER=1 \
			 -DCONFIG_RTSP_DEMUXER=1 \
			 -DCONFIG_SAMI_DEMUXER=1 \
			 -DCONFIG_SAP_DEMUXER=1 \
			 -DCONFIG_SBG_DEMUXER=1 \
			 -DCONFIG_SDP_DEMUXER=1 \
			 -DCONFIG_SEGAFILM_DEMUXER=1 \
			 -DCONFIG_SHORTEN_DEMUXER=1 \
			 -DCONFIG_SIFF_DEMUXER=1 \
			 -DCONFIG_SMACKER_DEMUXER=1 \
			 -DCONFIG_SMJPEG_DEMUXER=1 \
			 -DCONFIG_SMUSH_DEMUXER=1 \
			 -DCONFIG_SOL_DEMUXER=1 \
			 -DCONFIG_SOX_DEMUXER=1 \
			 -DCONFIG_SPDIF_DEMUXER=1 \
			 -DCONFIG_SRT_DEMUXER=1 \
			 -DCONFIG_STR_DEMUXER=1 \
			 -DCONFIG_SUBVIEWER1_DEMUXER=1 \
			 -DCONFIG_SUBVIEWER_DEMUXER=1 \
			 -DCONFIG_SWF_DEMUXER=1 \
			 -DCONFIG_TAK_DEMUXER=1 \
			 -DCONFIG_TEDCAPTIONS_DEMUXER=1 \
			 -DCONFIG_THP_DEMUXER=1 \
			 -DCONFIG_TIERTEXSEQ_DEMUXER=1 \
			 -DCONFIG_TMV_DEMUXER=1 \
			 -DCONFIG_TRUEHD_DEMUXER=1 \
			 -DCONFIG_TTA_DEMUXER=1 \
			 -DCONFIG_TXD_DEMUXER=1 \
			 -DCONFIG_TTY_DEMUXER=1 \
			 -DCONFIG_VC1_DEMUXER=1 \
			 -DCONFIG_VC1T_DEMUXER=1 \
			 -DCONFIG_VIVO_DEMUXER=1 \
			 -DCONFIG_VMD_DEMUXER=1 \
			 -DCONFIG_VOBSUB_DEMUXER=1 \
			 -DCONFIG_VOC_DEMUXER=1 \
			 -DCONFIG_VPLAYER_DEMUXER=1 \
			 -DCONFIG_VQF_DEMUXER=1 \
			 -DCONFIG_W64_DEMUXER=1 \
			 -DCONFIG_WAV_DEMUXER=1 \
			 -DCONFIG_WC3_DEMUXER=1 \
			 -DCONFIG_WEBVTT_DEMUXER=1 \
			 -DCONFIG_WSAUD_DEMUXER=1 \
			 -DCONFIG_WSVQA_DEMUXER=1 \
			 -DCONFIG_WTV_DEMUXER=1 \
			 -DCONFIG_WV_DEMUXER=1 \
			 -DCONFIG_XA_DEMUXER=1 \
			 -DCONFIG_XBIN_DEMUXER=1 \
			 -DCONFIG_XMV_DEMUXER=1 \
			 -DCONFIG_XWMA_DEMUXER=1 \
			 -DCONFIG_YOP_DEMUXER=1 \
			 -DCONFIG_YUV4MPEGPIPE_DEMUXER=1 \
			 -DCONFIG_LIBGME_DEMUXER=0 \
			 -DCONFIG_LIBMODPLUG_DEMUXER=0 \
			 -DCONFIG_LIBNUT_DEMUXER=0 \
			 -DCONFIG_LIBQUVI_DEMUXER=0
endif

CFLAGS += -Wall -std=gnu99 -pedantic $(fpic)

ifeq ($(DEBUG), 1)
   CFLAGS += -O0 -g
else
   CFLAGS += -O3
endif

ifeq ($(HAVE_GL), 1)
   ifeq ($(GLES), 1)
      LIBS += -lGLESv2
      CFLAGS += -DGLES
   else
      LIBS += $(GL_LIB)
   endif
   SOURCE += glsym.c
endif

OBJECTS := $(SOURCE:.c=.o)

all: $(TARGET)

%.o: %.c
	$(CC) -c -o $@ $< $(CFLAGS)

$(TARGET): $(OBJECTS)
	$(CC) -o $@ $^ $(LIBS) $(SHARED)

clean:
	rm -f $(OBJECTS)
	rm -f $(TARGET)

.PHONY: clean

